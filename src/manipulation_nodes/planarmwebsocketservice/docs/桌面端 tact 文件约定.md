# 桌面端软件与机器人端 TACT 文件约定

**说明:** 本约定尚未生效和实现，仅作为与桌面端的提前约定，后续开发人员实现时，请按照本约定进行。

**说明:** 本约定尚未生效和实现，仅作为与桌面端的提前约定，后续开发人员实现时，请按照本约定进行。

**说明:** 本约定尚未生效和实现，仅作为与桌面端的提前约定，后续开发人员实现时，请按照本约定进行。

## 现有情况
> 日期: 2025-08-15

现在 tact 文件在 kuavo 和 roban 机器人上的使用情况:

**kuavo**
- `robotType`: 从`"40"` ~ `"49"`，其中`40,41,42`为短手臂版， `43,45,46,47,48,49` 为长手臂版
- 关节长度固定为 28，包含手臂、手指、头部关节数据
- 关节顺序定义: 左臂 7 关节 + 右臂 7 关节 + 左手指 6 关节 + 右手指 6 关节 + 头部 2 关节

**roban**
- `robotType`: `"11"`
- 关节长度固定为 8，即仅包含手臂的关节数据
- 关节顺序定义: 左臂 4 关节 + 右臂 4 关节

## 与桌面端软件 TACT 文件新约定

**版本匹配约定:**
- tact 文件中的`robotType`字段用于指定与该 tact 文件匹配的机器人类型，不允许不同机器人版本的 tact 文件交替使用
  - 例如在 kuavo 上运行 roban 的 tact 文件，是不允许的，在 roban 上运行 kuavo 的 tact 文件，也是不允许的
  - 在末端为灵巧手的机器人上运行 47 版本（末端为夹爪）的tact 文件，也是不允许的
- **关键点:** kuavo 与 roban 不可混用， kuavo 长手版与短手版不可以混用，kuavo 灵巧手版和夹爪版不可混用.

**关于 kuavo 的约定:**
- 关节长度固定为 29, 包含手臂、手指、头部、腰部关节数据
- 关节顺序定义: 左臂 7 关节 + 右臂 7 关节 + 左末端 6 关节 + 右末端 6 关节 + 头部 2 关节 + 腰部 1 关节
- 关于腰部关节: 现在4X都是没有腰关节的，因此补齐维度即可，从50版本开始才会有腰
- 末端指的是灵巧手或者夹爪
  - 对于末端类型维灵巧手的版本，末端关节数据即对应: 大拇指关节，拇指外展肌，食指关节, 中指关节，无名指关节，小指关节
  - 对于末端类型为夹爪的版本（47），由于夹爪的关节为 1，因此末端数据需要补齐数据维度

**关于 roban 的约定:**
- 关节长度固定为 23，即仅包含手臂、手指、头、腰关机数据
- 关节顺序定义: 左臂 4 关节 + 右臂 4 关节 + 左手 6 关节 + 右手 6 关节 + 头 2 关节 + 腰 1 关节
- roban 机器人存在没有手或者头等关节情况，桌面端需要在 tact 文件中补齐数据维度


## 机器人端兼容性与更改

### 兼容性
- 现有的 kuavo 的 tact 文件关节数据长度为 28， 未包含腰关节数据，后续在处理时需要区分兼容这种情况
- 由于现已有一些 roban 的 tact 文件中关节数据长度为 8，后续在处理时需要区分兼容这种情况
- 机器人端在处理 tact 时，需要根据`robotType`和当前机器人的`robot_version`来判断是否匹配，如果不匹配需要报错提示，匹配规则:
  - 机器人类型匹配: 区分 kuavo 与 roban
  - 手臂长短类型匹配: 区分 kuavo 长手版与短手版
  - 末端类型匹配: 区分 kuavo 灵巧手版与夹爪版
- 对于后续`robotType`为 50 之后的 kuavo，会有腰部自由度，考虑兼容现有 tact，只能在最后为追加腰部自由度

### 涉及更改

- planarmwebsocketservice包提供桌面端 App 的 websocket 接口
- Kuavo Humanoid SDK 中 blockly 积木块模块有关 tact 文件处理
- humanoid_plan_arm_trajectory 包中提给 H12 遥控器的 ROS 服务接口