# Roban2 腿部磨线工具

用于Roban2机器人腿部磨线的EtherCAT驱动器控制工具，通过多电机协调运动实现腿部线缆的磨合检查。

## 🚀 安装与编译

### 编译项目

```bash
mkdir build && cd build    # 创建并进入build文件夹
cmake ..
make
```

> ⚠️ 注意：编译完成后，`build/src` 目录下会生成 Python 扩展模块 `leg_breakin.so`。

## ⚙️ 配置说明

### 环境变量配置

- **ROBOT_VERSION**：指定机器人型号（13或14），影响编码器范围配置
- **驱动器类型**：配置文件 `~/.config/lejuconfig/EcMasterType.ini` 可指定驱动器类型

### ENI 配置文件

- 位置：`config/ENI_config/` 目录
- 格式：XML格式的EtherCAT网络配置文件
- 默认配置：`yd300_13_c501.xml`

## 📖 使用方法

> ⚠️ 重要提示：本工具需要root权限运行，请确保在安全的环境中使用。

### 启动程序

```bash
sudo su
python3 roban2_leg_breakin.py
```

### 功能说明

程序启动后会自动执行Roban2腿部磨线功能，包含以下特点：

- **多电机协调**：同时控制13个电机（1-13号）
- **对称动作**：左脚和右脚执行对称的磨线动作
- **动作序列**：每个电机执行7个不同的动作，确保全方位磨线
- **时间控制**：用户可自定义总运行时间

### 动作序列说明

#### 左腿电机（2-7号）
- 电机2：左腿关节1
- 电机3：左腿关节2
- 电机4：左腿关节3
- 电机5：左腿关节4
- 电机6：左腿关节5
- 电机7：左腿关节6

#### 右腿电机（8-13号）
- 与左腿电机执行对称动作
- 电机2-4对应电机13-11（取反动作）
- 电机5-7对应电机10-8（同向动作）

## 🔧 使用流程

### 准备工作

1. **机器人准备**：将机器人吊起，确保安全
2. **电机定位**：将电机摆正到零点位置
   - 大腿电机：自然垂直向下
   - 其他关节：按标准零点位置摆放
3. **权限检查**：确保以root权限运行

### 执行步骤

1. **启动程序**：
   ```bash
   sudo su
   python3 roban2_leg_breakin.py
   ```

2. **设置运行时间**：
   - 程序会提示输入总运行时间
   - 最少需要14秒（7个动作 × 2秒/动作）
   - 建议设置较长时间以确保充分磨线

3. **监控运行**：
   - 程序会自动执行磨线动作
   - 13个电机会协调运动
   - 完成后会显示执行结果

## ⚠️ 安全注意事项

1. **机器人安全**：确保机器人已吊起，避免意外碰撞
2. **线缆检查**：磨线前检查线缆是否完好，避免损坏
3. **环境安全**：确保周围无障碍物，预留足够空间
4. **权限安全**：仅在受控环境中使用root权限

## ❓ 常见问题与解答

### Q：程序提示无root权限？

A：使用 `sudo su` 切换到root用户后再运行程序。

### Q：电机不动作或动作异常？

A：检查以下几点：
1. 确认机器人已正确吊起
2. 检查电机是否已摆正到零点
3. 确认EtherCAT网络连接正常
4. 检查驱动器配置是否正确

### Q：如何调整磨线强度？

A：当前版本使用预设的动作序列，如需调整可修改 `EC_master_tools.py` 中的动作参数，或配置单个动作的间隔时间 `motion_duration`。
