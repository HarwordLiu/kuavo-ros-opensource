# ğŸ® æ¨¡å‹éƒ¨ç½²

### 1. AGX ORINè¿è¡Œç¯å¢ƒé…ç½®
- é¦–å…ˆæ£€æŸ¥ä¸Šä½æœºAGXæ˜¯å¦å·²ç»å®‰è£…`py310kuavomimc`è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœå¯ä»¥`source ~/py310kuavomimic/bin/activate`ï¼Œåˆ™å·²å®‰è£…
- `pip show lerobot` å’Œ `pip show kuavo` æ£€æŸ¥æ˜¯å¦æœ‰è¾“å‡ºï¼Œæœ‰åˆ™å·²å®‰è£…ä¾èµ–
-  ç»ˆç«¯è¾“å…¥`python`å›è½¦ï¼Œè¾“å…¥`import torch;torch.cuda.is_available()`,å¦‚æœç»“æœæ˜¯trueåˆ™å®‰è£…armç‰ˆæœ¬å·²torchå·²ç»å®‰è£…
- `source ~/kuavo-il-opensource/kuavo/kuavo_3deploy/utils/kuavo_ws/devel/setup.bash`ï¼Œå¦‚æœæˆåŠŸåˆ™å·²ç¼–è¯‘æ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå¯ä»¥source `~/kuavobrain/devel/setup.bash`ã€‚å¦‚æœéƒ½æ²¡æœ‰ï¼Œè¯·æŠŠä¸‹ä½æœºçš„ç›¸å…³çš„`kuavo_msgs`åŒ…æ‹·è´åˆ°ä¸Šä½æœºç¼–è¯‘ã€‚
å¦‚æœä»¥ä¸Šç¯å¢ƒç¼ºå¤±ï¼Œå¯ä»¥æ ¹æ®ä»¥ä¸‹æ–¹æ³•å®‰è£…ï¼š
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd ~
python3.10 -m venv py310kuavomimic
source ~/py310kuavomimic/bin/activate

# å®‰è£…ä¾èµ–
git clone https://gitee.com/leju-robot/kuavo-il-opensource.git
cd kuavo-il-opensource
pip install -e lerobot
pip install -e kuavo

# æ›¿æ¢armç‰ˆæœ¬torch(æ¥æº: https://pypi.jetson-ai-lab.dev/jp5/cu114, æŒ‚æ¢¯å­æ›´å¿«)
cd ~
wget https://pypi.jetson-ai-lab.dev/jp5/cu114/+f/8b3/cd6e6090269bd/torch-2.2.0-cp310-cp310-linux_aarch64.whl#sha256=8b3cd6e6090269bd5f0ed3e1f7412f8616097b3493a08e1955b3d5f7f3481a44
wget https://pypi.jetson-ai-lab.dev/jp5/cu114/+f/a23/9d8b8b13c337e/torchvision-0.17.2+c1d70fe-cp310-cp310-linux_aarch64.whl#sha256=a239d8b8b13c337e742124669438e4152b4ead04c72486db330141b312404e86
å¦‚æœä¸Šé¢ä¸¤ä¸ªè¿æ¥å¤±æ•ˆï¼Œå¯ä»¥ä»ä»¥ä¸‹åœ°å€ä¸‹è½½ï¼šhttp://120.55.169.67/downloads/
wget http://120.55.169.67/downloads/torch-2.2.0-cp310-cp310-linux_aarch64.whl 
wget http://120.55.169.67/downloads/torchvision-0.17.2+c1d70fe-cp310-cp310-linux_aarch64.whl
å¦‚æœå¤ªæ…¢,å¯ä»¥ä»ä»¥ä¸‹åœ°å€ä¸‹è½½ï¼š
curl -o torchvision-0.17.2%2Bc1d70fe-cp310-cp310-linux_aarch64.whl "https://kuavo.ks3-cn-shanghai.ksyuncs.com/datahub/aarch_torch/torchvision-0.17.2%2Bc1d70fe-cp310-cp310-linux_aarch64.whl?AccessKeyId=TEMPb44a9a1HuBH0hYUBMuxcT96mUmQ7%2FD7eyBdpYJSfZpWiP9hqT3t3WVEi9bHbUjxPBr0rYfjzvbegtzdSd7%2BBAXe%2B6myw5n2FeB6evorDqjsn1XxFOg%2BbGQ9vogizdonKYSBUOrEwq9a0r79jX%2BUpOv1oQg%3D%3D&Expires=3902114989&Signature=tYXMJJMDKQ%2BfqAY73i4jHIfw%2B6o%3D"
curl -o torch-2.2.0-cp310-cp310-linux_aarch64.whl "https://kuavo.ks3-cn-shanghai.ksyuncs.com/datahub/aarch_torch/torch-2.2.0-cp310-cp310-linux_aarch64.whl?AccessKeyId=TEMPb44a9a1HuBH0hYUBMuxcT96mUmQ7%2FD7eyBdpYJSfZpWiP9hqT3t3WVEi9bHbUjxPBr0rYfjzvbegtzdSd7%2BBAXe%2B6myw5n2FeB6evorDqjsn1Xym1b6PvXWZhOrskAmexxsUAAkqLx5l%2F73Ikb4takUi1g%3D%3D&Expires=3902115231&Signature=eYdanbb4KtP00eDvYLXAabhaF8M%3D"

pip install torch-2.2.0-cp310-cp310-linux_aarch64.whl torchvision-0.17.2+c1d70fe-cp310-cp310-linux_aarch64.whl
# å®‰è£…å®Œç»ˆç«¯è¾“å…¥pythonï¼Œimport torch;torch.cuda.is_available(),å¦‚æœç»“æœæ˜¯trueåˆ™å®‰è£…armç‰ˆæœ¬torchæˆåŠŸ

# ç¼–è¯‘æ¶ˆæ¯ç±»å‹
cd ~/kuavo-il-opensource/kuavo/kuavo_3deploy/utils/kuavo_ws/
catkin_make -DPYTHON_EXECUTABLE=/usr/bin/python3 -DCMAKE_POLICY_VERSION_MINIMUM=3.5
source ~/py310kuavomimic/bin/activate
source ~/kuavo-il-opensource/kuavo/kuavo_3deploy/utils/kuavo_ws/devel/setup.bash

# å…¶ä»–å·¥å…·
sudo apt install direnv # å¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹æ¿€æ´»ç¯å¢ƒå˜é‡æˆ–è€…åŠ è½½å…¶ä»–é…ç½®
```

### éƒ¨ç½²é…ç½®
`æ³¨`ï¼šè‹¥æœªé‡‡é›†å¤´éƒ¨å…³èŠ‚ä¿¡æ¯ï¼Œå°½é‡ä¿è¯å¤´éƒ¨ä¸å¤´éƒ¨æ‘„åƒæœºè§†è§’ä¸é‡‡é›†æ•°æ®æ—¶ä¸€è‡´(å¤´éƒ¨å…³èŠ‚å’Œæœºå™¨äººç«™ä½)ã€‚
`Zed`: å¦‚æœä½¿ç”¨Zedç›¸æœºï¼Œå°†`head_cam_h:  &head_cam_h_obs  ["/cam_h/color/image_raw/compressed", "CompressedImage", 30, [640, 480]]`ä¿®æ”¹ä¸ºï¼š`head_cam_l:  &head_cam_h_obs  ["/zedm/zed_node/left/image_rect_color/compressed", "CompressedImage", 30, [640, 480]]`
é…ç½®éƒ¨ç½²å‚æ•° (`kuavo/kuavo_3deploy/resources/deploy_config.yaml`)ï¼š
1. deploy_config.yaml(kuavo/kuavo_3deploy/resources/deploy_config.yaml), ä¸æ•°æ®è½¬æ¢çš„é…ç½®æ–‡ä»¶å¯¹åº”
    - policy: `act`
    - ckpt_path:`pretrained_model`æ‰€åœ¨æ–‡ä»¶è·¯å¾„
    - which_arm: `left` or `right` or `both`
    - eef_type: `dex_hand` or `leju_claw`
    - frequency: `10` or `30` or ..., è¿™é‡Œä¸æ•°æ®è½¬æ¢æ—¶å€™`train_hz`å¯¹é½
    - go_bag_path: å½•åˆ¶åˆ°è¾¾å·¥ä½œä½ç½®çš„bagï¼Œèµ·å§‹ä¸º0ä½ï¼Œç»“æŸä¸ºæ•°æ®é›†å¼€å§‹çš„ä½ç½®

    ```yaml
    ### ATTENTION: æ ¹æ®æ¨¡å‹è®­ç»ƒçš„é…ç½®ä¿®æ”¹ä»¥ä¸‹å‚æ•°
    policy: "act"                                                    # ç­–ç•¥ç±»å‹
    ckpt_path: /home/leju_kuavo/model/Task26_waic_dex/model_preview  # æ¨¡å‹è·¯å¾„
    which_arm: "both"                                                # ä½¿ç”¨æ‰‹è‡‚ï¼šleft/right/both
    eef_type: "dex_hand"                                             # æœ«ç«¯æ‰§è¡Œå™¨ï¼šdex_hand/leju_claw
    frequency: 10                                                    # è®­ç»ƒæ—¶é‡‡æ ·çš„é¢‘ç‡ï¼Œé»˜è®¤æ˜¯10hz(ç›¸æœºrawæ•°æ®æ˜¯30hz, è®­ç»ƒæ—¶é‡‡æ ·é¢‘ç‡æ˜¯10hz)
    go_bag_path: "/home/leju_kuavo/kuavo_il/go_final.bag"            # ç”¨æ•°é‡‡å¹³å°é‡‡é›†æ•°æ®æ—¶å½•åˆ¶çš„åˆ°è¾¾å·¥ä½œä½ç½®çš„bagåŒ…ï¼Œå³åˆ°è¾¾æ•°æ®é›†å¼€å§‹ä½ç½®çš„åŒ…
    use_temporal_ensembler: True                                     # æ˜¯å¦ä½¿ç”¨æ—¶åŸŸé›†æˆï¼Œç”¨äºå¹³æ»‘è½¨è¿¹ï¼Œä½†æ˜¯è½¨è¿¹è¾“å‡ºé¢‘ç‡ä¼šé™ä½ã€‚è‹¥é€Ÿåº¦æ…¢å¯ä»¥è®¾ç½®ä¸ºFalseä½†æ˜¯ç‰ºç‰²å¹³æ»‘åº¦ã€‚

    ### ATTENTION: çµå·§æ‰‹é€šå¸¸è§†ä¸ºäºŒå€¼(æŠ“/æ”¾ï¼‰ï¼Œè‹¥éœ€æµ‹è¯•å…¨è‡ªç”±åº¦å¯å°†qiangnao_sliceéƒ¨åˆ†ä¿®æ”¹ä¸ºleft: [0, 6], right: [6, 12]
    kuavo_arm_of_sensors_data_raw_slice:  ### len(/sensors_data_raw.joint_data.joint_q) == 28, 
    left: [12, 19]                      # [12, 19]æ˜¯å·¦è‡‚7ä¸ªå…³èŠ‚ï¼Œ
    right: [19, 26]                     # [19, 26]æ˜¯å³è‡‚
    qiangnao_slice:                       ### len(/dexhand/state.position) == 12, å·¦å³æ‰‹å„6ä¸ªå…³èŠ‚
    left: [0, 1]                        # [0, 1]æ˜¯å·¦æ‰‹æŒ‡ç¬¬ä¸€ä¸ªå…³èŠ‚
    right: [6, 7]                       # [6, 7]æŒ‡å³æ‰‹æŒ‡ç¬¬ä¸€ä¸ªå…³èŠ‚
    leju_claw_slice:                      ### len(/leju_claw_state.position) == 2, å·¦å³å¤¹çˆªå„1ä¸ªå…³èŠ‚
    left: [0, 1]                        # [0, 1]æ˜¯å·¦æ‰‹å¤¹çˆª
    right: [1, 2]                       # [1, 2]æŒ‡å³æ‰‹å¤¹çˆª
    ```

2. example.py(kuavo/kuavo_3deploy/example/example.py)
    - `arm.kuavo_interface.control_head(yaw=-40, pitch=0)`, å¤´éƒ¨æ§åˆ¶ï¼Œå°½å¯èƒ½ä¿è¯å¤´éƒ¨å§¿æ€ä¸æ•°æ®é‡‡é›†æ—¶ç›¸åŒ
    - ä»»åŠ¡è®¾ç½®
    ```python
    task = "go_run"  # go_run, here_run, back_to_zero
    task_map = {
        "go_run": arm.go_run,   # åˆ°è¾¾å·¥ä½œä½ç½®ç›´æ¥è¿è¡Œæ¨¡å‹
        "here_run": arm.here_run,   # ä»go_bagçš„æœ€åä¸€å¸§çŠ¶æ€å¼€å§‹è¿è¡Œ
        "back_to_zero": arm.back_to_zero,   # ä¸­æ–­æ¨¡å‹æ¨ç†åï¼Œå€’æ”¾bagåŒ…å›åˆ°0ä½
        "run": arm.run,  # ä»å½“å‰ä½ç½®ç›´æ¥è¿è¡Œæ¨¡å‹
        "go": arm.go    # åˆ°è¾¾å·¥ä½œä½ç½®
    }  
    ```
3. è¿è¡Œä¸‹ä½æœºç¨‹åºä½¿æœºå™¨äººç«™ç«‹ï¼ˆå‘½ä»¤è¡Œå¯åŠ¨æˆ–è€…é¥æ§å™¨å¯åŠ¨éƒ½å¯ä»¥ï¼‰  
4. å¯åŠ¨ç›¸æœºèŠ‚ç‚¹
ä¸Šä½æœºAGXç»ˆç«¯æ‰§è¡Œï¼š
    ```bash
    cd ~/kuavo_data_pilot/src/kuavo_data_pilot_bin/scripts/
    ./start_camera.sh
    ``` 
5. å¦å¼€ç»ˆç«¯è¿è¡Œ`example.py`(å»ºè®®åˆæ¬¡ä½¿ç”¨è°ƒè¯•è¿è¡Œï¼Œå¹¶æŸ¥çœ‹æ¨¡å‹è¾“å‡ºå…³èŠ‚è§’åº¦æ˜¯å¦åˆç†ï¼Œä»¥å…å‡ºç°é—®é¢˜)
    ```bash
    source ~/py310kuavomimic/bin/activate
    source ~/kuavo-il-opensource/kuavo/kuavo_3deploy/utils/kuavo_ws/devel/setup.bash
    python kuavo/kuavo_3deploy/examples/example.py --task go
    python kuavo/kuavo_3deploy/examples/example.py --task run
    ```
    | ä»»åŠ¡ç±»å‹ | è¯´æ˜ |
    |---------|------|
    | `go` | åˆ°è¾¾å·¥ä½œä½ç½® |
    | `run` | ä»å½“å‰ä½ç½®ç›´æ¥è¿è¡Œæ¨¡å‹ |
    | `go_run` | åˆ°è¾¾å·¥ä½œä½ç½®ç›´æ¥è¿è¡Œæ¨¡å‹ |
    | `here_run` | ä»go_bagçš„æœ€åä¸€å¸§çŠ¶æ€å¼€å§‹è¿è¡Œ |
    | `back_to_zero` | ä¸­æ–­æ¨¡å‹æ¨ç†åï¼Œå…ˆæ’å€¼å›bagæœ€åä¸€å¸§çš„ä½ç½®ï¼Œç„¶åå€’æ”¾bagåŒ…å›åˆ°0ä½ |

# å¸¸è§é—®é¢˜

### 1. é—®é¢˜æè¿°
è‹¥æ¨¡å‹éƒ¨ç½²è¿è¡Œä¸€æ®µæ—¶é—´åç»ˆç«¯å‡ºç°ï¼š
```bash
ERROR: æ‰§è¡Œä»»åŠ¡ run æ—¶å‘ç”Ÿé”™è¯¯ï¼šä¼ æ„Ÿå™¨é—´æœªåŒæ­¥ï¼š æ—¶é—´æˆ³arrayï¼š
```
### 2. åˆ†æè§£å†³
æ‰“å¼€`~/kuavo-il-opensource/sync_time_according_to_master.sh`  
å…ˆæŒ‰æ³¨é‡Šåœ¨æœ¬åœ°æœºå™¨ä¸Šç”ŸæˆSSHå¯†é’¥å’Œå°†æœ¬åœ°å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨çš„authorized_keysæ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œæ­¤è„šæœ¬ã€‚
